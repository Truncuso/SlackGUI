program MY_TSlackGUI;
{$I ../SlackGUI.simba}
{$H-}

const
  RS_WIDTH   = 900;
  RS_HEIGHT  = 510;

  clBG0 = 0;
  clBG1 = $1F1A13;//$332222;
  clBG2 = $2F2A23;//$443333
  clBG3 = $3F3A33;//9140597;

  clFG1 = $FFFFFF;
  clFG2 = 16767488;
  clFG3 = 7369204;


var
  MyGUI: TSlackGUI;


procedure OnCloseWindow(Sender: TFormObject); static;
begin
  SlackGUI.Form.Close();
end;

procedure DrawClient(Self: TFormObject);
var
  newW, newH, X,Y,W,H: Int32;
  tmp: TBitmap;
  muf: TMufasaBitmap;
  B: TRect;
begin
  B := self.Bounds;
  X := B.Left;
  Y := B.Top;
  W := B.Right-X;
  H := B.Bottom-Y;

  muf.Init();
  muf.CopyClientToBitmap(client.GetIOManager(), True, 0,130,RS_WIDTH-1,130+RS_HEIGHT-1);
  muf.ResizeEx(RM_Bilinear, W-10,H-10);
  tmp := muf.ToTBitmap;
  SlackGUI.Canvas.Draw(x+5,y+5,tmp);
  tmp.Free();
  muf.Free();

  SlackGUI.Canvas.DrawBorder(B, Self.Styles.BorderSize, Self.Styles.BorderColor);
end;


procedure TSlackGUI.Init(); static; override;
var
  TitleBar, TopObject, Label1, Body: TFormObject;
  W, H: Int32;

  function DefaultStyles(): TStyleSet;
  begin
    Result.Background  := clBG2;
    Result.BorderColor := clBG0;
    Result.BorderSize := 0;
    Result.FontColor  := clFG1;
    Result.FontStyle  := [fsBold];
    Result.FontSize   := 10;
    Result.FontName   := 'Tahoma';
  end;

begin
  SlackGUI.Width  := 900;
  SlackGUI.Height := 480;
  inherited;

  W := SlackGUI.Width;
  H := SlackGUI.Height;

  with (TopObject := SlackGUI.AddObject(FormObject('Stub')))^ do
  begin
    Position := bpRelative;
    Styles   := DefaultStyles;
    Styles2  := Styles;
    RenderProc := @RenderBasicBlock;
  end;

  with (TitleBar := SlackGUI.AddObject(WndDragObject('TitleBar', [0,0,W,29], TopObject)))^ do
  begin
    Styles.Background := clBG1;
    RenderProc := @RenderBasicBlock;
  end;

  with TTextObject(SlackGUI.AddObject(TextObject('TitleText', TitleBar.Bounds, TitleBar)))^ do
  begin
    Bounds := Rect(Bounds.Left+15, Bounds.Top+5, 0,0);
    Text   := SlackGUI.Form.GetCaption;

    Styles := DefaultStyles;
    Styles.FontColor  := clFG1;
    Styles.Background := clBG2;
    Styles.FontStyle  := [fsBold];
    Styles.FontSize   := 12;

    RenderProc := @RenderText;
  end;

  with TButtonObject(SlackGUI.AddObject(ButtonObject('GUIClose', TitleBar.Bounds, TitleBar)))^ do
  begin
    Bounds := Rect(Bounds.Right-26, Bounds.Top+4, Bounds.Right-4, Bounds.Bottom-4);
    Text   := ' X';
    Styles.FontName   := 'MS Sans Serif';
    Styles.Background := clBG2;
    Styles.FontSize   := 13;
    Styles.FontStyle  := [fsBold];
    Styles.FontColor  := $777777;

    Styles2 := Styles;
    Styles2.Background := $0000FF;
    Styles2.FontColor  := $FFFFFF;

    RenderProc := @RenderTextButton;
    OnClick    := @OnCloseWindow;
  end;

  with (Body := SlackGUI.AddObject(FormObject('MainBody', [15,45,-15,-15], TopObject)))^ do
  begin
    Position := bpRelative;
    RenderProc := @RenderBasicBlock;
  end;

  with SlackGUI.AddObject(FormObject('Client', [0,0,-230,-70], Body))^ do
  begin
    Position := bpRelative;
    Styles.BorderSize  := 4;
    Styles.BorderColor := clBG1;
    Styles.Background  := clBG2;
    RenderProc := @DrawClient;
  end;

  with TLabelObject(Label1 := SlackGUI.AddObject(LabelObject('Label1', [650,-8,0,0], Body)))^ do
  begin
    Position := bpRelative;
    Text := 'Label test';

    Styles := DefaultStyles;
    Styles.FontColor   := clFG1;
    Styles.BorderColor := clBG1;
    Styles.BorderSize  := 4;
    Styles.Background  := clBG3;
    Styles.FontStyle   := [fsBold];

    RenderProc := @RenderLabelBlock;
  end;

  with TTextObject(SlackGUI.AddObject(TextObject('MyText', [15, H-80], Body)))^ do
  begin
    Position := bpAbsolute;
    Text := 'Do you wish to test me: ';

    Styles := DefaultStyles;
    Styles.FontColor   := clFG1;
    Styles.BorderColor := clBG0;
    RenderProc := @RenderText;
  end;

  with TCheckBoxObject(SlackGUI.AddObject(CheckboxObject('Checkbox', [176, H-78], Body)))^ do
  begin
    SetWidth(15);
    SetHeight(15);

    Position := bpAbsolute;
    Styles.Background  := clBG3;
    Styles.BorderColor := $AAAAAA;
    Styles.BorderSize  := 1;

    Styles2 := Styles;
    Styles2.BorderColor := $FFFF00;

    RenderProc := @RenderCheckbox;
  end;

  SlackGUI.Form.ShowModal;
end;


begin
  MyGUI.Show();
end.
